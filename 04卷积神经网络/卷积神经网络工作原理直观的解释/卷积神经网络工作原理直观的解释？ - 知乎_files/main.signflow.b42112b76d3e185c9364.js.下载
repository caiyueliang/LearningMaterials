webpackJsonp([1],{1286:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){var t=e.register,n=t.registerValidateSucceeded,r=t.registerConfirmSucceeded,o=t.registerValidateErrors,a=t.registerConfirmError;return{registerValidateSucceeded:n,registerConfirmSucceeded:r,registerValidateErrors:o,captchaValidationMessage:e.captcha.captchaValidationMessage,registerConfirmError:a}}function c(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e){var t=e.register;return{registerConfirmError:t.registerConfirmError,sendDigitsError:t.sendDigitsError,registerConfirmSucceeded:t.registerConfirmSucceeded}}function m(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function w(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function O(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function D(e){var t=e.active;return{sendDigitsError:t.sendDigitsError,activeConfirmSucceeded:t.activeConfirmSucceeded,activeConfirmError:t.activeConfirmError}}function B(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function F(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function A(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function V(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function U(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function L(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var H,Z,K,Y,G,J,$,Q,X,ee,te,ne,re,oe,ae,ie,ce,se,le,ue,pe,fe,de,he,me,ye,be,ge=n(1),ve=n.n(ge),we=n(0),Ee=n.n(we),Ce=n(3),Se=n(4),Oe=n(444),Pe=n(126),Ne=n(8),_e=n(9),je=n(128),Te=n(101),ke=n(125),Re=n(178),De=n(179),Be=n(271),Ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Me=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Fe=(H=Object(Ce.connect)(i,{validateRegister:Pe.g,resetRegisterValidateResult:Pe.c,validateSNSRegister:Pe.i}),Z=Object(_e.a)({module:"SignUpForm"}),H(K=Z((G=Y=function(e){function t(){var e,n,a,i;r(this,t);for(var c=arguments.length,s=Array(c),l=0;l<c;l++)s[l]=arguments[l];return n=a=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.state={validationResult:{}},a.checkAllInputFilled=function(){if(a.allInputFilled)return a.allInputFilled;var e=a.props,t=e.phoneNo,n=e.password,r=e.fullname,o=e.bySocial;return a.allInputFilled=(Boolean(t)||o)&&(Boolean(n)||o)&&Boolean(r),a.allInputFilled},a.handleSubmit=function(e){var t=a.props,n=t.validateRegister,r=t.validateSNSRegister,o=t.selectedCountry,i=t.captcha,c=t.bySocial,s=t.socialType,l=e.phoneNo,u=e.password,p=e.fullname,f=Object(Oe.b)(),d=f.atoken,h=f.atokenExpiredIn,m=f.clientId,y={accessToken:d,expiresAt:h,appkey:Ne.g[s],registerType:s,socialId:m,source:"com.zhihu.web"},b=c?Ie({fullname:p,captcha:i},y):{phoneNo:""+o.code+l,password:u,fullname:p,captcha:i};c?r(Ie({},b)):n(Ie({},b))},a.parseErrorMessages=function(){var e=a.props,t=e.registerValidateErrors,n=void 0===t?{}:t,r=e.onSwitch,o=e.selectedCountry,i=e.phoneNo,c=e.password,s=n.phoneNo,l=void 0===s?{}:s,u=n.fullname,p=void 0===u?{}:u,f=n.password,d=void 0===f?{}:f,h=l.code,m=l.message;return{phoneNoError:100028===h?Ee.a.createElement("span",null,"该手机号已注册 · ",Ee.a.createElement(Se.default,{preset:"plain",style:{color:"#3f3f3f"},onClick:function(){return r({selectedCountry:o,username:i,password:c})}},"直接登录")):m,fullnameError:p.message,passwordError:d.message}},a.handleLogSubmit=function(){Object(Be.b)(a,"SignUp",a.buildZAAccount())},a.handleLogSubmitValidateError=function(e){Object(Be.d)(a,"SignUp",a.buildZAAccount(),e)},i=n,o(a,i)}return a(t,e),Me(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.registerValidateSucceeded,r=t.onSendDigits,o=t.captchaValidationMessage,a=t.registerConfirmSucceeded,i=e.bySocial,c=e.registerValidateSucceeded,s=e.captchaValidationMessage,l=e.registerConfirmSucceeded,u=e.registerConfirmError,p=e.registerValidateErrors;if(n!==c&&!1===c||a!==l&&!1===l)this.handleLogSubmitValidateError(u||p),this.setState({validationResult:{needsRefresh:!0,timestamp:Date.now()}});else if(n||!c||i)if(!a&&l){Object(Oe.a)(["atoken","atokenExpiredIn"]);var f=location,d=f.pathname,h=f.search,m=f.hash;location.href="/"+(d?"?next="+d:"")+h+m,this.handleLogSubmitSuccess()}else o!==s&&(this.setState({validationResult:{message:s,needsRefresh:Boolean(s),timestamp:Date.now()}}),s&&this.handleLogSubmitValidateError(s));else r(),this.handleLogSubmitSuccess()}},{key:"componentWillUnmount",value:function(){this.props.resetRegisterValidateResult(),Object(Oe.a)(["atoken","atokenExpiredIn"])}},{key:"buildZAAccount",value:function(){var e=this.props,t=e.phoneNo,n=e.selectedCountry.code,r=e.bySocial,o=e.socialType;return r?{type:Be.a[o]}:{email:null,phone:t?""+n+t:null,type:"Zhihu"}}},{key:"handleLogSubmitSuccess",value:function(){Object(Be.c)(this,"SignUp",this.buildZAAccount())}},{key:"render",value:function(){var e=this.props,t=e.onChange,n=e.phoneNo,r=e.fullname,o=e.password,a=e.selectedCountry,i=e.bySocial,c=this.parseErrorMessages(),s=c.phoneNoError,l=c.fullnameError,u=c.passwordError,p=this.state.validationResult;return Ee.a.createElement(Te.b,{className:"SignFlow",onSubmit:this.handleSubmit,onPreSubmit:this.handleLogSubmit,onInvalid:this.handleLogSubmitValidateError},!i&&Ee.a.createElement(ke.a,{type:"register",onSelect:function(e){return t("selectedCountry",e)},onChange:function(e){return t("phoneNo",e)},defaultPhoneNo:n,defaultSelectedCountry:a,manualValidateError:s}),!i&&Ee.a.createElement(Re.a,{onChange:function(e){return t("password",e)},defaultValue:o,manualValidateError:u}),Ee.a.createElement(De.a,{onChange:function(e){return t("fullname",e)},name:"fullname",placeholder:"姓名",defaultValue:r,manualValidateError:l}),Ee.a.createElement(je.a,{className:"SignFlow-captchaContainer",canCaptchaShown:this.checkAllInputFilled(),type:"register",onUpdateInput:function(e){return t("captcha",e)},validationResult:p}),Ee.a.createElement(Se.default,{className:"SignFlow-submitButton",preset:"primary",color:"blue",type:"submit"},"注册"))}}]),t}(we.Component),Y.propTypes={supportedCountries:ve.a.array,registerValidateSucceeded:ve.a.bool,registerValidateErrors:ve.a.object,registerConfirmError:ve.a.string,captchaValidationMessage:ve.a.string,onSendDigits:ve.a.func.isRequired,phoneNo:ve.a.string,password:ve.a.string,fullname:ve.a.string,onChange:ve.a.func.isRequired,captcha:ve.a.string,bySocial:ve.a.bool,socialType:ve.a.string},Y.defaultProps={bySocial:!1},K=G))||K)||K),Ae=Fe,Ve=n(24),qe=n(7),xe=(n(1437),function(e){var t=e.title;return Ee.a.createElement("div",{className:"SignFlowModalHeader"},Ee.a.createElement("h1",{className:"SignFlowModalHeader-title"},t),Ee.a.createElement("h2",{className:"SignFlowModalHeader-subTitle"},"与世界分享你的知识、经验和见解"))}),Ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ze=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),We=($=J=function(e){function t(){var e,n,r,o;s(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.handleSwitch=function(){qe.default.trackEvent(r,{action:"Click",element:"Button",element_name:"SignIn"});var e=r.props,t=e.selectedCountry,n=e.phoneNo,o=e.password;(0,e.onSwitch)({selectedCountry:t,username:n,password:o})},o=n,l(r,o)}return u(t,e),ze(t,[{key:"render",value:function(){var e=this.props,t=e.onClose,n=e.shown,r=e.onSwitch,o=c(e,["onClose","shown","onSwitch"]);return Ee.a.createElement(Ve.default,{className:"SignFlow-modal",onClose:t,maskClosable:!1,spread:!0},n&&Ee.a.createElement("div",null,Ee.a.createElement(xe,{title:"加入知乎"}),Ee.a.createElement(Ae,Ue({onSwitch:r},o)),Ee.a.createElement("div",{className:"SignFlowModal-registerFooter"},Ee.a.createElement("span",null,"注册即代表同意",Ee.a.createElement(Se.default,{preset:"plain",component:"a",target:"_blank",href:"/terms"},"《知乎协议》")),Ee.a.createElement("span",null,"已有帐号？",Ee.a.createElement(Se.default,{className:"SignFlowModal-switchButton",preset:"plain",onClick:this.handleSwitch,disabled:!n},"登录")))))}}]),t}(we.Component),J.propTypes={onClose:ve.a.func.isRequired,shown:ve.a.bool,onSwitch:ve.a.func},J.defaultProps={shown:!1},$),Le=We,He=n(5),Ze=n(173),Ke=n(180),Ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ge=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Je=(Q=Object(Ce.connect)(h,{sendDigits:Pe.d,confirmRegister:Pe.a}))((te=ee=function(e){function t(){var e,n,r,o;p(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={modalFooterContent:null,smsType:"text",smsBackUpName:"语音",reStartTime:-1,interceptTime:-1,sendSMSCodeCount:0,smsBackUpDisplay:!0},r.handleModalFooterStatus=function(e){r.setState({modalFooterContent:e})},r.handleChangeSmsType=function(){r.setState(function(e){var t=e.smsType;return{smsType:"text"===t?"voice":"text",smsBackUpName:"text"===t?"短信":"语音",reStartTime:Date.now()}})},r.handleCountDownEndEvent=function(){r.setState({smsBackUpDisplay:!0})},r.handleSubmit=function(e){var t=r.props,n=t.phoneNo,o=t.fullname,a=t.password;(0,t.confirmRegister)(Ye({},e,{phoneNo:n,fullname:o,password:a,registerType:"phone_digits",source:"com.zhihu.web"}))},r.handleSendDigits=function(){var e=r.props,t=e.sendDigits,n=e.phoneNo,o=r.state,a=o.smsType,i=o.sendSMSCodeCount;t(n,a),0!==i&&r.setState({smsBackUpDisplay:!1}),r.setState(function(e){return{sendSMSCodeCount:e++}})},o=n,f(r,o)}return d(t,e),Ge(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.sendDigitsError,n=e.sendDigitsError;if(!this.props.registerConfirmSucceeded&&e.registerConfirmSucceeded){Object(Ke.b)(this.props.phoneNo);var r=location,o=r.pathname,a=r.search,i=r.hash;location.href="/"+(o?"?next="+o:"")+a+i}!t&&n&&(this.setState({interceptTime:Date.now()}),this.handleCountDownEndEvent())}},{key:"render",value:function(){var e=this,t=this.props,n=t.phoneNo,r=t.onBack,o=t.registerConfirmError,a=t.sendDigitsError,i=t.onClose,c=t.shown,s=this.state,l=s.modalFooterContent,u=s.smsType,p=s.smsBackUpDisplay,f=s.smsBackUpName,d=s.reStartTime,h=s.interceptTime,m=o?o.digitsError:"";return Ee.a.createElement(Ve.default,{onClose:i,footer:l},c?Ee.a.createElement("div",{className:"RegisterSMSCodeVerificationDialog"},Ee.a.createElement(Se.default,{className:"RegisterSMSCodeVerificationDialog-backButton",preset:"plain",onClick:r},Ee.a.createElement(He.a,{name:"arrowLeft",width:17,height:17})),Ee.a.createElement("div",{className:"RegisterSMSCodeVerificationDialog-header"},Ee.a.createElement("h1",{className:"RegisterSMSCodeVerificationDialog-title"},"验证手机"),Ee.a.createElement("h2",{className:"RegisterSMSCodeVerificationDialog-subtitle"},"请输入你收到的 6 位数验证码")),Ee.a.createElement(Te.b,{className:"RegisterSMSCodeVerificationDialog-form",onSubmit:this.handleSubmit},Ee.a.createElement("div",{className:"RegisterSMSCodeVerificationDialog-phoneNo"},n),Ee.a.createElement(Ze.a,{countDownEvent:function(){return e.handleSendDigits()},manualValidateError:a||m,countDownEndEvent:this.handleCountDownEndEvent,smsType:u,reStartTime:d,interceptTime:h,startAtOnce:!0}),Ee.a.createElement("div",{className:"RegisterSMSTypeOptions"},Ee.a.createElement(Se.default,{preset:"plain",className:"RegisterSMSTypeCut",onClick:this.handleChangeSmsType},p&&"接收"+f+"验证码")),Ee.a.createElement("div",{className:"RegisterSMSCodeVerificationDialog-buttonContainer"},Ee.a.createElement(Se.default,{className:"RegisterSMSCodeVerificationDialog-enterButton",preset:"primary",color:"blue",type:"submit"},"进入知乎")))):null)}}]),t}(we.Component),ee.PropTypes={phoneNo:ve.a.string.isRequired,fullname:ve.a.string.isRequired,password:ve.a.string.isRequired,onBack:ve.a.func,sendDigits:ve.a.func,confirmRegister:ve.a.func,registerConfirmError:ve.a.string,modalFooterContentShown:ve.a.bool,modalFooterContent:ve.a.node,onClose:ve.a.func.isRequired,shown:ve.a.bool},ee.defaultProps={hasBackButton:!1,modalFooterContentShown:!1,modalFooterContent:null,shown:!1},X=te))||X,$e=Je,Qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Xe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),et={smsCodeVerificationShown:!1,phoneNo:"",password:"",fullname:"",captcha:"",selectedCountry:{name:"中国",code:"+86"}},tt=(re=ne=function(e){function t(){var e,n,r,o;b(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=g(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state=Qe({},et),r.handleChange=function(e,t){r.setState(y({},e,t))},r.handleClose=function(){r.setState(Qe({},et),function(){r.props.onClose()})},r.handleSendDigits=function(){r.setState(function(e){return{smsCodeVerificationShown:!e.smsCodeVerificationShown}})},r.renderSMSCodeVerification=function(){var e=r.state,t=e.selectedCountry.code,n=e.phoneNo,o=e.fullname,a=e.password,i=e.smsCodeVerificationShown;return Ee.a.createElement($e,{onClose:r.handleSendDigits,onBack:r.handleSendDigits,phoneNo:""+t+n,fullname:o,password:a,shown:i})},o=n,g(r,o)}return v(t,e),Xe(t,[{key:"render",value:function(){var e=this.props,t=e.isInModal,n=e.shown,r=m(e,["isInModal","shown"]),o=this.state,a=o.phoneNo,i=o.password,c=o.fullname,s=o.selectedCountry,l=o.captcha,u=o.smsCodeVerificationShown,p=Qe({phoneNo:a,password:i,fullname:c,selectedCountry:s,captcha:l,onSendDigits:this.handleSendDigits,onChange:this.handleChange},r);return Ee.a.createElement("div",null,t&&Ee.a.createElement(Le,Qe({},p,{shown:n&&!u,onClose:this.handleClose})),n&&!t&&Ee.a.createElement(Ae,p),this.renderSMSCodeVerification())}}]),t}(we.Component),ne.propTypes={isInModal:ve.a.bool,onClose:ve.a.func,shown:ve.a.bool.isRequired},ne.defaultProps={isInModal:!1},re),nt=tt,rt=(n(1438),nt),ot=n(428),at=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},it=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ct=(ae=oe=function(e){function t(){var e,n,r,o;E(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=C(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={modalExtraInfo:null},r.handleModalExtraInfo=function(e){r.setState({modalExtraInfo:e})},o=n,C(r,o)}return S(t,e),it(t,[{key:"render",value:function(){var e=this.props,t=e.shown,n=w(e,["shown"]),r=this.state.modalExtraInfo;return Ee.a.createElement(Ve.default,{className:"SignFlow-modal",onClose:n.onClose,footer:r,maskClosable:!1,spread:!0},t&&Ee.a.createElement("div",null,Ee.a.createElement(xe,{title:"登录知乎"}),Ee.a.createElement(ot.a,at({onShowExtraInfo:this.handleModalExtraInfo},n))))}}]),t}(we.Component),oe.propTypes={onClose:ve.a.func.isRequired,shown:ve.a.bool},oe.defaultProps={shown:!1},ae),st=ct,lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ut=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),pt=(ce=ie=function(e){function t(){var e,n,r,o;P(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=N(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={type:"password",passwordType:"email"},r.handleChangeType=function(e){if("email"===e||"oversea"===e)return void r.setState({type:"password",passwordType:e});r.setState({type:e})},o=n,N(r,o)}return _(t,e),ut(t,[{key:"render",value:function(){var e=this.props,t=e.isInModal,n=e.shown,r=e.onClose,o=O(e,["isInModal","shown","onClose"]),a=this.state,i=a.type,c=a.passwordType,s=lt({type:i,passwordType:c,onChangeType:this.handleChangeType},o);return Ee.a.createElement("div",null,t&&Ee.a.createElement(st,lt({shown:n,onClose:r},s)),n&&!t&&Ee.a.createElement(ot.a,s))}}]),t}(we.Component),ie.propTypes={isInModal:ve.a.bool,onClose:ve.a.func,onSwitch:ve.a.func,shown:ve.a.bool},ie.defautProps={isInModal:!1},ce),ft=pt,dt=(n(447),ft),ht=n(448),mt=n(53),yt=(n(1287),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),bt=(se=Object(Ce.connect)(D,{getUnlockTicketAndDigits:ht.c,activeUserByEmail:ht.a,validateAndActiveUserByDigits:ht.d,activeUser:mt.a}))((pe=ue=function(e){function t(e){T(this,t);var n=k(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.checkUserAccountType=function(e){return e.email?"email":"noInfo"},n.handleChange=function(e,t){n.setState(j({},e,t))},n.handleChangeSmsType=function(){n.setState(function(e){var t=e.smsType;return{smsType:"text"===t?"voice":"text",smsBackUpName:"text"===t?"短信":"语音",reStartTime:Date.now()}})},n.handleCountDownEndEvent=function(){n.setState({smsBackUpDisplay:!0})},n.handleSendDigits=function(){var e=n.props.getUnlockTicketAndDigits,t=n.state,r=t.selectedCountry.code,o=t.phoneNo,a=t.smsType;n.setState({manualError:null},function(){if(o)return e({newPhoneNo:""+r+o,smsType:a}),void n.setState({smsBackUpDisplay:!1});n.setState({manualError:"请输入手机号",smsInputInterceptTime:Date.now()})})},n.handleSubmit=function(e){var t=n.props,r=t.email,o=t.activeUserByEmail,a=t.validateAndActiveUserByDigits,i=t.onClose,c=n.state,s=c.accountType,l=c.selectedCountry.code,u=e.username,p=e.digits;"email"===s?(o({email:r}),"function"==typeof i&&i()):a({newPhoneNo:""+l+u,digits:p})},n.parseServerError=function(){var e=n.props,t=e.activeConfirmError,r=e.sendDigitsError,o=t||{},a=o.username,i=o.digits,c=r||{},s=c.username;return{usernameServerError:a||s,digitsServerError:i}},n.renderAccountInfo=function(){var e=n.props.email,t=n.state,r=t.accountType,o=t.manualError,a=n.parseServerError(),i=a.usernameServerError;return"noInfo"!==r?Ee.a.createElement("div",{className:"SignFlowActive-account"},e,"email"===r&&Ee.a.createElement("a",{target:"_blank",href:"/settings/account",className:"SignFlowActive-editEmail"},"修改邮箱")):Ee.a.createElement(ke.a,{type:"digits",supportedCountriesShown:!0,manualValidateError:i||o,onSelect:function(e){return n.handleChange("selectedCountry",e)},onChange:function(e){return n.handleChange("phoneNo",e)}})},n.state={accountType:n.checkUserAccountType(e),selectedCountry:{code:"+86",name:"中国"},phoneNo:null,smsInputInterceptTime:-1,manualError:null,smsType:"text",smsBackUpName:"语音",smsBackUpDisplay:!0,reStartTime:-1},n}return R(t,e),yt(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.sendDigitsError,r=t.onClose,o=t.activeUser,a=e.activeConfirmSucceeded,i=e.sendDigitsError;a?(r(),o()):!n&&i&&(this.setState({smsInputInterceptTime:Date.now()}),this.handleCountDownEndEvent())}},{key:"render",value:function(){var e=this.state,t=e.accountType,n=e.smsInputInterceptTime,r=e.smsType,o=e.smsBackUpName,a=e.smsBackUpDisplay,i=e.reStartTime,c=this.parseServerError(),s=c.digitsServerError;return Ee.a.createElement(Te.b,{className:"SignFlowActive SignFlow",onSubmit:this.handleSubmit},this.renderAccountInfo(),"email"!==t&&[Ee.a.createElement(Ze.a,{key:"sms-input",manualValidateError:s,interceptTime:n,countDownEvent:this.handleSendDigits,countDownEndEvent:this.handleCountDownEndEvent,smsType:r,reStartTime:i}),a&&Ee.a.createElement("div",{key:"smsBackUp-button",className:"SignFlowActive-options"},Ee.a.createElement(Se.default,{preset:"plain",className:"SignFlowActive-cutSmsType",onClick:this.handleChangeSmsType},"接收"+o+"验证码"))],Ee.a.createElement(Se.default,{className:"email"===t?"SignFlowActive-sendEmail":"SignFlowActive-sendDigits",preset:"primary",color:"blue",type:"submit"},"email"===t?"发送激活邮件":"激活"))}}]),t}(we.Component),ue.propTypes={email:ve.a.string,sendDigitsError:ve.a.object,getUnlockTicketAndDigits:ve.a.func,activeUserByEmail:ve.a.func,validateAndActiveUserByEmail:ve.a.func,activeConfirmSucceeded:ve.a.bool,activeConfirmError:ve.a.object,onClose:ve.a.func},le=pe))||le,gt=bt,vt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Et=(de=fe=function(e){function t(){var e,n,r,o;I(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=M(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={snackbar:null},r.handleSetSnackbar=function(e){return r.setState({snackbar:e})},o=n,M(r,o)}return F(t,e),wt(t,[{key:"render",value:function(){var e=this.props,t=e.shown,n=e.onClose,r=B(e,["shown","onClose"]);return Ee.a.createElement(Ve.default,{className:"SignFlow-modal",title:"激活帐号",subtitle:"为了正常使用知乎的提问、回答、评论和编辑功能，请绑定你的手机",onClose:n,maskClosable:!1,footer:this.state.snackbar},t&&Ee.a.createElement(gt,vt({onClose:n,onSetSnackbar:this.handleSetSnackbar},r)))}}]),t}(we.Component),fe.propTypes={shown:ve.a.bool.isRequired,onClose:ve.a.func.isRequired},de),Ct=Et,St=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ot=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Pt=(me=he=function(e){function t(){return V(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return x(t,e),Ot(t,[{key:"render",value:function(){var e=this.props,t=e.isInModal,n=e.shown,r=e.onClose,o=A(e,["isInModal","shown","onClose"]);return Ee.a.createElement("div",null,t?Ee.a.createElement(Ct,St({onClose:r,shown:n},o)):Ee.a.createElement(gt,o))}}]),t}(we.Component),he.propTypes={isInModal:ve.a.bool,shown:ve.a.bool,onClose:ve.a.func},he.defaultProps={isInModal:!1},me),Nt=Pt,_t=(n(449),Nt),jt=(n(1439),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),Tt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),kt=(be=ye=function(e){function t(){return z(this,t),W(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return L(t,e),Tt(t,[{key:"render",value:function(){var e=this.props,t=e.type,n=U(e,["type"]),r=jt({isInModal:!0},n);return Ee.a.createElement("div",{className:"SignFlowModal"},Ee.a.createElement(rt,jt({},r,{shown:"register"===t})),Ee.a.createElement(dt,jt({},r,{shown:"login"===t})),Ee.a.createElement(_t,jt({},r,{shown:"active"===t})))}}]),t}(we.Component),ye.propTypes={type:ve.a.oneOf(["register","login","initial","active"]),onClose:ve.a.func.isRequired,onSwitch:ve.a.func},be);t.default=kt},1287:function(e,t){},1288:function(e,t){},1437:function(e,t){},1438:function(e,t){},1439:function(e,t){},1440:function(e,t){},1467:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"default",function(){return p});var i=n(0),c=n.n(i),s=n(24),l=n(450),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.onClose,n=e.signType;return c.a.createElement(s.default,{className:"signFlowModal",onClose:t},c.a.createElement(l.a,{signType:n}))}}]),t}(i.Component)},1468:function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function N(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var _,j,T,k,R,D,B,I,M,F,A,V,q,x,U=n(1),z=n.n(U),W=n(0),L=n.n(W),H=n(3),Z=n(451),K=n(4),Y=n(44),G=n.n(Y),J=n(7),$=n(101),Q=n(125),X=n(445),ee=n(446),te=n(103),ne=(n(1440),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),re=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),oe=function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["","s 后可重发"],["","s 后可重发"]),ae=(_=Object(H.connect)(function(e){return{isIOS:e.env.userAgent.iOS}}))((k=T=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),re(t,[{key:"render",value:function(){var e=this.props,t=e.countDownEvent,n=e.startAtOnce,a=e.interceptTime,i=e.resetText,c=e.manualValidateError,s=e.onChange,l=e.validations,u=e.countDownEndEvent,p=e.reStartTime,f=e.isIOS,d=o(e,["countDownEvent","startAtOnce","interceptTime","resetText","manualValidateError","onChange","validations","countDownEndEvent","reStartTime","isIOS"]);return L.a.createElement("div",{className:"SignFlow SignFlow-smsBindPhoneInputContainer"},L.a.createElement(te.a,ne({name:"digits",className:"SignFlow-smsBindPhoneInput",type:f?"tel":"number",errorMessageClassName:"SignFlow-smsBindPhoneInputErrorMask",placeholder:"输入 6 位验证码",manualValidateError:c,onChange:s,validations:[{type:"required",message:"请填写验证码",className:"SignFlow-smsInputBindPhoneRequiredErrorMask"}].concat(r(l||[]))},d)),L.a.createElement(X.a,{className:"SignFlow-smsBindPhoneInputButton",preset:"plain",initialText:"发送验证码",resetText:i,countingText:Object(ee.a)(oe,"count"),startAtOnce:n,event:t,countDownEndEvent:u,interceptTime:a,reStartTime:p}))}}]),t}(W.Component),T.propTypes={countDownEvent:z.a.func.isRequired,startAtOnce:z.a.bool,interceptTime:z.a.number,resetText:z.a.string,manualValidateError:z.a.string},T.defaultProps={startAtOnce:!1,resetText:"重发验证码"},j=k))||j,ie=ae,ce=n(8),se=(n(1287),n(1288),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),le=(D=R=function(e){function t(){var e,n,r,o;l(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={selectedCountry:{code:"+86",name:"中国"},phoneNo:null,smsInputInterceptTime:-1,manualError:null,showFooter:!1,sendValidationCodeButtonText:"发送验证码",identifyingCodeError:null},r.testPhoneNo=function(){var e=r.state,t=e.selectedCountry.code,n=e.phoneNo,o=/^\d{11}$/;return"+86"!==t||o.test(n)},r.handleChange=function(e){return function(t){r.setState(s({},e,t))}},r.handleSendDigits=function(e){var t=r.props.requestPhoneVerificationCode,n=r.state,o=n.selectedCountry.code,a=n.phoneNo,i=n.manualError;if(J.default.trackEvent(e.target,{action:"GetCaptcha"}),r.testPhoneNo())return t(""+o+a).then(function(){r.setState({manualError:null})}).catch(function(e){var t=e.err;t=void 0===t?{}:t;var n=t.payload;n=void 0===n?{}:n;var o=n.message;return r.setState({manualError:o,smsInputInterceptTime:Date.now()})});return r.setState({manualError:"请输入正确的手机号"===i?" 请输入正确的手机号":"请输入正确的手机号",smsInputInterceptTime:Date.now()})},r.handleSubmit=function(e){var t=e.phoneNo,n=e.digits,o=r.props,a=o.updatePhoneNumber,i=o.onSuccess,c=o.onNeedUnbind,s=r.state,l=s.selectedCountry.code,u=s.identifyingCodeError;a(""+l+t,n).then(function(e){var n=e.payload,r=n.data;if(n.success)return i();var o=r.bindedAccountFullname,a=r.requestAccountFullname;return c({phoneNumber:t,bindName:o,requiredName:a})}).catch(function(e){var t=e.err;t=void 0===t?{}:t;var n=t.payload;n=void 0===n?{}:n;var o=n.code,a=n.message;o===ce.n&&r.setState({identifyingCodeError:u===a?" "+a:a})})},r.handleZaOK=function(e){J.default.trackEvent(e.target,{action:"Ok"})},r.renderContent=function(){var e=r.state,t=e.smsInputInterceptTime,n=e.manualError,o=e.sendValidationCodeButtonText,a=e.identifyingCodeError;return L.a.createElement("div",{ref:function(e){r.container=e}},L.a.createElement($.b,{className:"SignFlowActive SignFlow BindPhoneForm",onSubmit:r.handleSubmit},!1,L.a.createElement(Q.a,{type:"register",supportedCountriesShown:!0,manualValidateError:n,onSelect:r.handleChange("selectedCountry"),onChange:r.handleChange("phoneNo")}),L.a.createElement(ie,{key:"sms-input",resetText:o,interceptTime:t,countDownEvent:r.handleSendDigits,manualValidateError:a}),L.a.createElement("div",{className:"BindPhone-helpWrapper"},L.a.createElement(K.default,{className:"BindPhone-helpText",preset:"link",onClick:function(){r.setState({showFooter:!0})}},"需要帮助？")),L.a.createElement(K.default,{className:"SignFlowActive-sendDigits",preset:"primary",color:"blue",type:"submit",onClick:r.handleZaOK},"确认")))},o=n,u(r,o)}return p(t,e),se(t,[{key:"componentDidMount",value:function(){J.default.setModule(this.container,{module:"BindPhoneForm"}),J.default.trackCardShow(this.container)}},{key:"render",value:function(){var e=this.props.onClose,t=this.state.showFooter;return L.a.createElement(G.a,{title:"设置手机号",subtitle:"绑定手机后，你就可以使用知乎的提问、回答、评论等功能。",footer:t?"如需要帮助，请联系 i@zhihu.com，我们会尽快帮你解决":null,onClose:e,size:"default"},this.renderContent())}}]),t}(W.Component),R.propTypes={requestPhoneVerificationCode:z.a.func.isRequired,updatePhoneNumber:z.a.func.isRequired,onClose:z.a.func.isRequired,onSuccess:z.a.func.isRequired,onNeedUnbind:z.a.func.isRequired},D),ue=n(15),pe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),fe=(I=B=function(e){function t(){var e,n,r,o;f(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=d(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.zaKnowMore=function(e){J.default.trackEvent(e.target,{action:"OpenUrl",name:"了解更多"})},r.toBindPhone=function(e){var t=r.props.onBindPhone;J.default.trackEvent(e.target,{action:"OpenUrl",name:"去绑定手机"}),t()},r.handleClose=function(e){var t=r.props,n=t.onClose,o=t.config.canWrite;J.default.trackEvent(e.target,{action:"Cancel",name:o?"暂不绑定":"取消"}),n()},r.renderContent=function(){var e=r.props.config,t=e.tip,n=e.canWrite;return L.a.createElement("div",{ref:function(e){r.container=e}},L.a.createElement("p",null,t,L.a.createElement(ue.a,{preset:"link",target:"_blank",href:"https://zhuanlan.zhihu.com/p/27257715",onClick:r.zaKnowMore},"了解更多")),L.a.createElement("div",{className:"BindPhone-buttonSection"},L.a.createElement(ue.a,{className:"BindPhone-button",onClick:r.handleClose},n?"暂不绑定":"取消"),L.a.createElement(K.default,{className:"BindPhone-button",preset:"primary",color:"blue",onClick:r.toBindPhone},"去绑定手机")))},o=n,d(r,o)}return h(t,e),pe(t,[{key:"componentDidMount",value:function(){J.default.setModule(this.container,{module:"BindPhoneForm"}),J.default.trackCardShow(this.container)}},{key:"render",value:function(){var e=this.props.onClose;return L.a.createElement(G.a,{className:!1,title:"绑定手机",onClose:e,size:"default"},this.renderContent())}}]),t}(W.Component),B.PropTypes={config:z.a.object,onClose:z.a.func,onBindPhone:z.a.func},I),de=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),he=(F=M=function(e){function t(){var e,n,r,o;m(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=y(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.handleCancel=function(e){var t=r.props.onClose;J.default.trackEvent(e.target,{action:"Cancel",name:"不绑定"}),t()},o=n,y(r,o)}return b(t,e),de(t,[{key:"componentDidMount",value:function(){J.default.setModule(this.container,{module:"BindMailForm"}),J.default.trackCardShow(this.container)}},{key:"render",value:function(){var e=this,t=this.props.onClose;return L.a.createElement(G.a,{className:!1,title:"手机号绑定成功",onClose:t,size:"default"},L.a.createElement("div",{ref:function(t){e.container=t}},L.a.createElement("p",null,"由于你此前绑定的邮箱未经验证，未来请使用手机号登录知乎。"),L.a.createElement(K.default,{className:"BindPhone-remindLoginWithPhoneButton",onClick:this.handleCancel,preset:"primary",color:"blue"},"知道了")))}}]),t}(W.Component),M.PropTypes={onClose:z.a.func},F),me=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ye=(V=A=function(e){function t(){var e,n,r,o;g(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=v(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.handleCancel=function(e){var t=r.props.onCancel;J.default.trackEvent(e.target,{action:"Click",name:"暂不绑定"}),t()},r.handleConfirm=function(e){var t=r.props.onConfirm;J.default.trackEvent(e.target,{action:"Click",name:"确认解绑"}),t()},o=n,v(r,o)}return w(t,e),me(t,[{key:"componentDidMount",value:function(){J.default.setModule(this.container,{module:"BindPhoneFailForm"}),J.default.trackCardShow(this.container)}},{key:"render",value:function(){var e=this,t=this.props,n=t.onClose,r=t.phoneNumber,o=t.bindName,a=t.requiredName;return L.a.createElement(G.a,{className:!1,title:"绑定失败",onClose:n,size:"default"},L.a.createElement("div",{ref:function(t){e.container=t}},L.a.createElement("p",null,"你所输入的手机号 ",r," 已经被绑定到帐号「",o,"」。"),!1,L.a.createElement("p",null,"你可以选择将该手机号从该帐号中解绑，并绑定至当前帐号「",a,"」。"),!1,L.a.createElement("p",null,L.a.createElement("b",null,"解绑后，你将无法再通过手机号登录原帐号「",o,"」。")),L.a.createElement("div",{className:"BindPhone-buttonSection"},L.a.createElement(K.default,{className:"BindPhone-button",onClick:this.handleConfirm},"确认解绑"),L.a.createElement(K.default,{className:"BindPhone-button",preset:"primary",color:"blue",onClick:this.handleCancel},"暂不绑定"))))}}]),t}(W.Component),A.PropTypes={onClose:z.a.func.isRequired,onCancel:z.a.func.isRequired,onConfirm:z.a.func.isRequired,phoneNumber:z.a.string.isRequired,bindName:z.a.string.isRequired,requiredName:z.a.string.isRequired},V),be=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ge=(x=q=function(e){function t(){var e,n,r,o;E(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=C(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.handleUnbind=function(e){var t=r.props,n=t.onSuccess,o=t.monopolizePhoneNumber,a=t.showNotification;J.default.trackEvent(e.target,{action:"Click",name:"确认解绑"}),o().then(function(){return a("绑定成功！","white"),n()})},r.handleCancel=function(e){var t=r.props.onCancel;J.default.trackEvent(e.target,{action:"Click",name:"暂不绑定"}),t()},o=n,C(r,o)}return S(t,e),be(t,[{key:"componentDidMount",value:function(){J.default.setModule(this.container,{module:"BindPhoneVerifyForm"}),J.default.trackCardShow(this.container)}},{key:"render",value:function(){var e=this,t=this.props,n=t.onClose,r=t.bindName;return L.a.createElement(G.a,{className:!1,title:"解绑手机",onClose:n,size:"default"},L.a.createElement("div",{ref:function(t){e.container=t}},L.a.createElement("p",null,L.a.createElement("b",null,"解绑操作无法撤销。")),!1,L.a.createElement("p",null,"如果你没有其他登录方式，你将无法再使用帐号「",r,"」。"),L.a.createElement("div",{className:"BindPhone-buttonSection"},L.a.createElement(K.default,{className:"BindPhone-button",onClick:this.handleUnbind},"确认解绑"),L.a.createElement(K.default,{className:"BindPhone-button",preset:"primary",color:"blue",onClick:this.handleCancel},"暂不绑定"))))}}]),t}(W.Component),q.PropTypes={onClose:z.a.func.isRequired,onSuccess:z.a.func.isRequired,onCancel:z.a.func.isRequired,bindName:z.a.string.isRequired,showNotification:z.a.func.isRequired,monopolizePhoneNumber:z.a.string.isRequired},x),ve=n(181),we=n(16);n.d(t,"default",function(){return Te});var Ee,Ce,Se,Oe,Pe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Ne="LOGIN_WITH_PHONE",_e="NEED_UNBIND",je=function(e){var t=e.account,n=e.config,r=e.entities,o=r.users[e.currentUser],a=o.isActive,i=o.email;return{account:t,hasActiveEmail:a&&i,needShowLoginWithPhoneNumber:!a&&!!i,config:e.config,isWindow:n.isWindow}},Te=(Ee=Object(H.connect)(je,{requestPhoneVerificationCode:ve.g,updatePhoneNumber:ve.k,monopolizePhoneNumber:ve.e,showNotification:we.h,getUnlockRequest:ve.c,unlockTicketByDigits:ve.i,requestUnlockTicket:ve.h,unlockTicketByPassword:ve.j}))((Oe=Se=function(e){function t(){var e,n,r,o;O(this,t);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return n=r=P(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={},r.handleBindPhoneSuccess=function(){var e=r.props,t=e.needShowLoginWithPhoneNumber,n=e.showNotification,o=e.onToggle;return t?r.goToStep(Ne)():(n("绑定成功！","white"),setTimeout(function(){return location.reload()},2e3),o())},r.handleNeedUnbind=function(e){var t=e.bindName,n=e.phoneNumber,o=e.requiredName;return r.setState({bindName:t,phoneNumber:n,requiredName:o,step:_e})},r.goToStep=function(e){return function(){return r.setState({step:e})}},r.handleCloseWithReload=function(){return location.reload()},o=n,P(r,o)}return N(t,e),Pe(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.getUnlockRequest,r=t.hasActiveEmail,o=t.shown,a=t.isWindow,i=t.account,c=i.errorStatus,s=i.challenge,l=document.querySelector(".VerificationDialogModalHeader");if(e.shown&&!o){a||n();var u="";u=r?"CONFIRM_BIND_PHONE":!a&&c&&!l&&s&&s.length?"SAFETY_VERIFICATION":"BIND_PHONE",this.setState({step:u})}}},{key:"render",value:function(){var e=this.props,t=e.shown,n=e.requestPhoneVerificationCode,r=e.updatePhoneNumber,o=e.monopolizePhoneNumber,a=e.showNotification,i=e.config,c=e.account,s=e.isWindow,l=e.unlockTicketByDigits,u=e.requestUnlockTicket,p=e.unlockTicketByPassword,f=e.onToggle,d=this.state,h=d.step,m=d.bindName,y=d.phoneNumber,b=d.requiredName;return t?"CONFIRM_BIND_PHONE"===h?L.a.createElement(fe,{onBindPhone:this.goToStep(s?"BIND_PHONE":"SAFETY_VERIFICATION"),onClose:f,config:i}):"BIND_PHONE"===h?L.a.createElement(le,{onClose:f,onSuccess:this.handleBindPhoneSuccess,onNeedUnbind:this.handleNeedUnbind,requestPhoneVerificationCode:n,updatePhoneNumber:r}):h===Ne?L.a.createElement(he,{onClose:this.handleCloseWithReload}):h===_e?L.a.createElement(ye,{onClose:f,onCancel:this.goToStep("BIND_PHONE"),onConfirm:this.goToStep("CONFIRM_UNBIND"),bindName:m,phoneNumber:y,requiredName:b}):"CONFIRM_UNBIND"===h?L.a.createElement(ge,{onClose:f,onSuccess:this.handleBindPhoneSuccess,onCancel:this.goToStep("BIND_PHONE"),bindName:m,monopolizePhoneNumber:o,showNotification:a}):"SAFETY_VERIFICATION"===h?L.a.createElement(Z.VerificationModal,{account:c,unlockTicketByDigits:l,requestUnlockTicket:u,unlockTicketByPassword:p,onClose:f,onSuccess:this.goToStep("BIND_PHONE"),zaModuleName:"BindMailForm"}):null:null}}]),t}(W.Component),Se.propTypes={shown:z.a.bool.isRequired,onToggle:z.a.func.isRequired,needShowLoginWithPhoneNumber:z.a.bool.isRequired,config:z.a.object.isRequired,requestPhoneVerificationCode:z.a.func.isRequired,updatePhoneNumber:z.a.func.isRequired,monopolizePhoneNumber:z.a.func.isRequired},Ce=Oe))||Ce}});
//# sourceMappingURL=main.signflow.b42112b76d3e185c9364.js.map